
{% load static %}
<!-- Start System Monitor -->

<div class="w-full">
  <h3 class="text-center text-xl font-semibold text-gray-900 mb-4">{{system_monitor_panel_title}}</h3>
  <div class="border-t border-gray-200 mb-6"></div>
  {% if last_updated %}
  <div class="mb-4">
    {% if SYSTEM_MONITOR_DISPLAY_XDMOD_LINK %}
    <a target="_blank" href="{{SYSTEM_MONITOR_DISPLAY_XDMOD_LINK}}" class="inline-flex items-center text-primary-600 hover:text-primary-800 transition-colors duration-200">
      <img style="max-width: 100px" src="{% static 'coldfront/plugins/system_monitor/images/xdmod.png' %}" alt="XDMod logo" class="mr-2"> 
      <i class="fa fa-external-link" aria-hidden="true"></i>
    </a> 
    {% endif %}
  </div>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div id="chartUtilization" style="min-height: 270px;width: 100%;"></div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div id="chartJobs" style="min-height: 270px;width: 100%;"></div>
    </div>
  </div>
  <div class="flex justify-between items-end">
    {% if SYSTEM_MONITOR_DISPLAY_MORE_STATUS_INFO_LINK %}
    <div>
      <a target="_blank" href="{{SYSTEM_MONITOR_DISPLAY_MORE_STATUS_INFO_LINK}}" class="text-primary-600 hover:text-primary-800 transition-colors duration-200">
        More status info <i class="fa fa-external-link" aria-hidden="true"></i>
      </a>
    </div>
    {% endif %}
    <div class="text-sm text-gray-500">
      Last Updated: {{last_updated}}
    </div>
  </div>
  {% else %}
  <div class="bg-red-50 border border-red-200 rounded-lg p-4" role="alert">
    <div class="flex">
      <div class="flex-shrink-0">
        <i class="fa fa-info-circle text-red-400" aria-hidden="true"></i>
      </div>
      <div class="ml-3">
        <p class="text-sm text-red-800">Error getting system information.</p>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<!-- End System Monitor -->


<script>
    
    $(document).ready(function() {
        drawUtilization();
        drawJobs();
    });

    var utilization_data = {{ utilization_data | safe }};
    var jobs_data = {{ jobs_data | safe }};

    function drawUtilization() {

        var chart = c3.generate({
            bindto: '#chartUtilization',
            data: utilization_data,
            donut: {
                title: "Load"
            },
            legend: {
                item: {
                    onclick: function(id) {}
                }
            }
        });

    }

    function drawJobs() {

        var chart = c3.generate({
            bindto: '#chartJobs',
            data: jobs_data,
            donut: {
                title: "Jobs"
            },
            legend: {
                item: {
                    onclick: function(id) {}
                },
            }

        });

    }

</script>
